# Issue08: リッチタスクメモビューアーの開発

## 概要

現在のタスクメモ表示機能を拡張し、URLの自動リンク化やマークダウン形式のサポートなど、リッチなテキスト表示機能を実装します。これにより、ユーザーはより構造化されたメモを作成でき、情報の視認性と利便性が向上します。

## 現状の課題

現在のタスクメモ表示は単純なテキスト表示のみで、以下の制限があります：

1. テキストの書式設定（見出し、太字、箇条書きなど）ができない
2. リンクが機能しない（URLをクリックできない）
3. コードブロックなどの特殊な表示形式がサポートされていない
4. 長文テキストの構造化が難しい

## 機能要件

### 基本機能
- マークダウン記法のサポート
  - 見出し（#, ##, ###）
  - 強調（**太字**, *斜体*）
  - リスト（箇条書き、番号付きリスト）
  - コードブロック（インラインコード、複数行コード）
  - 引用（> による引用）
  - 水平線（---）
  - チェックボックス（- [ ], - [x]）
  - リンク（[テキスト](URL)形式と自動リンク）

### 拡張機能
- シンタックスハイライト（コードブロック内）
- テーブル表示
- 画像リンクのプレビュー表示
- 絵文字のサポート
- メモ内の特定のタスクIDへのリンク

## 技術的アプローチ

### 1. マークダウンパーサーライブラリの選定

以下のライブラリを候補として検討します：

1. **react-markdown**
   - 軽量で使いやすい
   - プラグインシステムによる拡張性
   - Reactコンポーネントとの統合が容易

2. **marked + DOMPurify**
   - 高速なパース
   - カスタマイズ性が高い
   - セキュリティ対策としてDOMPurifyと組み合わせる

3. **remark + rehype**
   - 高度なカスタマイズが可能
   - プラグインエコシステムが豊富
   - 処理パイプラインの柔軟な構築

比較検討の結果、**react-markdown**を採用します。理由は以下の通りです：
- Reactとの統合が容易
- プラグインによる拡張性
- 十分な機能セットと適度な軽量さ
- アクティブなメンテナンス

### 2. 実装計画

#### フェーズ1: 基本実装（2日）

- [x] 依存関係のインストール
- [x] TaskMemoViewer コンポーネントの作成
- [x] 基本的なマークダウン表示の実装
- [x] TaskDetailPage への統合

#### フェーズ2: 拡張機能の実装（2日）

- [x] シンタックスハイライトの追加
- [x] リンクのターゲット設定（外部リンクは新しいタブで開く）
- [x] チェックボックスのサポート
- [x] テーブル表示の実装

#### フェーズ3: ヘルプ機能とプレビュー機能（1日）

- [x] マークダウンヘルプモーダルの実装
- [x] プレビュー機能の実装
- [x] UIの調整とスタイリング

#### フェーズ4: テストと最適化（1日）

- [x] 単体テストの作成
- [x] 統合テストの作成
- [x] パフォーマンス最適化
- [x] アクセシビリティ対応

**合計予定工数: 6日**

## テスト計画

### 単体テスト
- [x] **TaskMemoViewer コンポーネントのテスト**
  - [x] 基本的なマークダウン変換のテスト
  - [x] 空のメモ表示のテスト
  - [x] リンク変換のテスト
  - [x] コードブロック表示のテスト

- [x] **MarkdownHelpModal コンポーネントのテスト**
  - [x] モーダル表示/非表示のテスト
  - [x] コンテンツ表示のテスト

### 統合テスト
- [x] **TaskDetailPage でのメモ表示テスト**
  - [x] メモ表示モードでのマークダウン表示
  - [x] 編集モードとプレビューモードの切り替え
  - [x] メモ保存後の表示確認

### アクセシビリティテスト
- [x] **キーボードナビゲーション**
  - [x] リンクへのフォーカス移動
  - [x] プレビューモードでのスクロール操作

- [x] **スクリーンリーダー対応**
  - [x] マークダウン構造の適切な読み上げ
  - [x] リンクの適切なラベル付け

## 技術的考慮事項

### セキュリティ
- ユーザー入力からのXSS攻撃を防ぐため、適切なサニタイズ処理を行う
- 外部リンクには `rel="noopener noreferrer"` を設定

### パフォーマンス
- 大きなメモの場合のレンダリングパフォーマンスを考慮
- 必要に応じてメモ表示のレンダリングを最適化

### アクセシビリティ
- マークダウンから変換されたHTMLが適切なARIA属性を持つようにする
- キーボードナビゲーションのサポート
- 高コントラストモードでの視認性確保

### 互換性
- 既存のメモデータとの互換性を維持
- モバイルデバイスでの表示最適化

## 将来の拡張性

1. **カスタムマークダウン拡張**
   - タスクIDの自動リンク化（例: #123 → タスク123へのリンク）
   - カスタム絵文字ショートコード

2. **エディタの強化**
   - マークダウンツールバー（太字、斜体などのボタン）
   - ドラッグ&ドロップでの画像添付

3. **検索機能の拡張**
   - メモ内容の全文検索
   - マークダウン構造を考慮した検索

## 結論

リッチタスクメモビューアーの実装により、TodoLogアプリケーションのメモ機能が大幅に強化され、ユーザーはより構造化された情報をタスクに関連付けることができるようになります。マークダウン記法のサポートにより、テキストの書式設定やリンク、コードブロックなどの高度な表現が可能になり、タスク管理の効率と情報の視認性が向上します。
## 実装完了報告

### 実装内容

#### 1. マークダウン表示機能
- react-markdownを使用したマークダウンレンダリング
- シンタックスハイライト（react-syntax-highlighter）
- テーブル、リスト、見出し、コードブロックなどの表示
- 外部リンクの自動検出と新しいタブでの開き方設定

#### 2. インタラクティブなチェックボックス
- マークダウン内のチェックボックス（- [ ], - [x]）をインタラクティブに
- チェック状態の変更をメモ内容に反映

#### 3. 編集とプレビュー機能
- メモ表示部分をクリックして直接編集可能
- 編集中のプレビュー表示切り替え
- キーボードショートカット（Ctrl+Enter で保存、Esc でキャンセル）

#### 4. マークダウンヘルプ機能
- マークダウン記法のヘルプモーダル
- 各記法の例とプレビュー表示
- アクセシブルなモーダルデザイン

#### 5. UI/UX改善
- 直感的な編集体験（クリックで編集開始）
- 視覚的フィードバック（ホバー効果、アクティブ状態）
- レスポンシブデザイン対応

### 技術的成果

1. **コンポーネント分離**
   - TaskMemoViewer: マークダウン表示専用コンポーネント
   - MarkdownHelpModal: ヘルプ表示用モーダル

2. **アクセシビリティ対応**
   - キーボードナビゲーション
   - スクリーンリーダー対応
   - ARIA属性の適切な使用

3. **パフォーマンス最適化**
   - 必要な時のみレンダリング
   - メモ化によるパフォーマンス向上

### 今後の展望

1. **機能拡張**
   - マークダウンツールバーの追加
   - 画像アップロード機能
   - タスクIDの自動リンク化

2. **ユーザビリティ向上**
   - マークダウンプレビューのリアルタイム更新
   - ドラッグ&ドロップでの画像挿入

### 結論

リッチタスクメモビューアーの実装により、TodoLogアプリケーションのメモ機能が大幅に強化されました。ユーザーはマークダウン記法を使用して構造化された情報をタスクに関連付けることができるようになり、情報の視認性と利便性が向上しました。また、直感的な編集体験とヘルプ機能の追加により、マークダウンに不慣れなユーザーでも簡単に活用できる設計となっています。
